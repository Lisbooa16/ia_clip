{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Radar Viral</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'analysis/style.css' %}">
</head>
<body>
    <div class="page">
        <header class="hero">
            <div>
                <p class="eyebrow">Análise narrativa e estratégia viral</p>
                <h1>Radar Viral</h1>
                <p class="subtitle">Cole a URL do vídeo e receba um plano editorial contextualizado.</p>
            </div>
        </header>

        <section class="card">
            <form method="post" class="form">
                {% csrf_token %}
                <label for="url">URL do vídeo (YouTube, TikTok ou Instagram)</label>
                <div class="form-row">
                    <input
                        id="url"
                        type="url"
                        name="url"
                        placeholder="https://"
                        value="{{ url }}"
                        required
                    >
                    <button type="submit">Analisar</button>
                </div>
                {% if error %}
                    <p class="error">{{ error }}</p>
                {% endif %}
            </form>
        </section>

        {% if result %}
            <section class="grid">
                <div class="card summary">
                    <h2>Resumo estratégico</h2>
                    <div class="score">
                        <div>
                            <p class="label">Score viral</p>
                            <p class="value">{{ result.score }}</p>
                        </div>
                        <span class="badge {{ result.score_label|lower }}">{{ result.score_label }}</span>
                    </div>

                    <div class="meta">
                        <p><strong>Plataforma:</strong> {{ result.platform|title }}</p>
                        <p><strong>Duração:</strong> {{ result.metadata.duration|default:"--" }}s</p>
                        <p><strong>Views:</strong> {{ result.metadata.views|default:"--" }}</p>
                        <p><strong>Engajamento:</strong> {{ result.metadata.engagement|default:"--" }}</p>
                    </div>

                    <div class="divider"></div>

                    <h3>Arquétipo narrativo</h3>
                    <p>{{ result.narrative_archetype }}</p>

                    <h3>Categoria viral</h3>
                    <p>{{ result.viral_category }}</p>

                    <h3>Motivação da audiência</h3>
                    <ul>
                        {% for item in result.audience_motivation %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="card">
                    <h2>Leitura da história</h2>
                    <p class="title">{{ result.metadata.title }}</p>
                    <p class="description">{{ result.metadata.description }}</p>

                    <div class="divider"></div>

                    <div class="story">
                        <div>
                            <h3>Evento central</h3>
                            <p>{{ result.story_insights.core_event }}</p>
                        </div>
                        <div>
                            <h3>Tensão narrativa</h3>
                            <p>{{ result.story_insights.narrative_tension }}</p>
                        </div>
                        <div>
                            <h3>Gatilho emocional</h3>
                            <p>{{ result.story_insights.emotional_pull }}</p>
                        </div>
                        <div>
                            <h3>Ângulo moral/social</h3>
                            <p>{{ result.story_insights.moral_angle }}</p>
                        </div>
                        <div>
                            <h3>Por que as pessoas compartilham</h3>
                            <p>{{ result.story_insights.share_reason }}</p>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <h3>Emoções acionadas</h3>
                    <ul class="chips">
                        {% for signal in result.emotional_triggers %}
                            <li>{{ signal }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </section>

            <section class="grid">
                <div class="card">
                    <h2>Cluster de conteúdo</h2>
                    {% if result.content_cluster %}
                        <ul>
                            {% for idea in result.content_cluster %}
                                <li>{{ idea }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="muted">Informação insuficiente para sugerir um cluster amplo.</p>
                    {% endif %}
                </div>

                <div class="card">
                    <h2>Vídeos semelhantes reais</h2>
                    {% if result.similar_videos %}
                        <div class="similar-grid">
                            {% for video in result.similar_videos %}
                                <article class="similar-card">
                                    {% if video.thumbnail %}
                                        <img src="{{ video.thumbnail }}" alt="Thumbnail de {{ video.title }}">
                                    {% endif %}
                                    <div>
                                        <p class="similar-title"><a href="{{ video.url }}" target="_blank">{{ video.title }}</a></p>
                                        <p class="similar-meta">{{ video.platform|title }} • {{ video.views|default:"--" }} views</p>
                                        <p class="similar-why">{{ video.why_similar }}</p>
                                        {% if video.narrative_take %}
                                            <p class="similar-take">{{ video.narrative_take }}</p>
                                        {% endif %}
                                    </div>
                                </article>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="muted">Sem vídeos semelhantes suficientes para comparação.</p>
                    {% endif %}
                </div>
            </section>

            <section class="grid">
                <div class="card">
                    <h2>Ideias de novos vídeos</h2>
                    {% if result.related_videos %}
                        <div class="ideas">
                            {% for idea in result.related_videos %}
                                <article>
                                    <h3>{{ idea.role|title }}</h3>
                                    <p class="idea">{{ idea.idea }}</p>
                                    <p class="focus">Foco: {{ idea.focus }}</p>
                                    <p class="why">{{ idea.why }}</p>
                                </article>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="muted">Sem sugestões específicas no momento.</p>
                    {% endif %}
                </div>

                <div class="card">
                    <h2>Estratégias de abertura</h2>
                    {% if result.opening_strategies %}
                        <ul>
                            {% for strategy in result.opening_strategies %}
                                <li>{{ strategy }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="muted">Sem estratégia sugerida por falta de contexto.</p>
                    {% endif %}
                </div>
            </section>
        {% endif %}
    </div>
</body>
</html>
